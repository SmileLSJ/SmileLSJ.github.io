---
layout:     post
title:      "JVM基础知识"
date:       2021-09-22 12:00:00
author:     "LSJ"
header-img: "img/post-bg-2015.jpg"
tags:
    - JVM
---



* Java项目是如何运行起来的？？

  ![image-20211009160202804](/img/image-20211009160202804.png)

  * Java文件，编译成class文件，为何要编程class文件呢，因为后面的操作中，只能识别class文件的内容
  * class文件如何运行呢
    * 系统启动JVM进程，来负责运行这些class字节码文件
    * 一旦启动一个系统，就是启动了一个JVM进程，由它来负责运行这台机器上运行的这个系统
  * 但是class文件在Jar包中，如何加载到JVM中呢？？？
    * 类加载器，把编译好的哪些class字节码文件加载到JVM中，然后让JVM来使用这些文件
  * 最后，JVM会使用字节码执行引擎来执行，由类加载器加载进来的class文件





## 类加载

* 一个类从加载到使用的过程

  * 加载

  * 验证

    * 根据Java虚拟机规范，来校验加载进来的class文件中的内容，是否符合指定的规范

      <img src="/img/image-20211009161006326.png" alt="image-20211009161006326" style="zoom:100%;" />

  * 准备

    * 作用：给类分配一定的空间

    * 给类里面的类变量（也就是statistic修饰的变量）分配内存空间，来一个默认的初始值

      ![image-20211009161128647](/img/image-20211009161128647.png)

  * 解析

    * 作用：把符号引用替换为直接引用的过程

      ![image-20211009161336548](/img/image-20211009161336548.png)

    * <font color='red'>验证，准备，解析，是给加载进来的类分配好了内存空间，类变量也分配好了内存空间，并且给了默认的初始值</font>

  * 初始化

    * 会执行初始化代码
    * 初始化代码
      1. static修饰的值，真正进行赋值，在准备阶段只是给了默认值，不会执行后面的初始化代码
      2. static修饰的代码块
    * <font color='red'>子类初始化的时候，如果父类没有初始化，那么就会进行初始化</font>，那么也可说，一个类使用的时候，先去执行父类的加载到使用的全部过程了

    ![image-20211009161816803](/img/image-20211009161816803.png)

  * 使用

  * 卸载

* 问题一：类是什么时候被加载到JVM中的呢？？？

  * 使用这个类的时候



### 类加载机制和双亲委托机制

#### 类加载器

* 类加载器
  1. 启动类加载器
     1. Bootstrap ClassLoader
        1. 作用：主要是负责加载在机器上安装的Java目录下的核心类，加载Java安装目录下的lib目录下的核心类库
  2. 扩展类加载器
     1. Extension ClassLoader
        1. 作用：加载Java安装目录下，一个"lib\ext"目录
  3. 应用程序类加载器
     1. Application ClassLoader
        1. 作用：复杂去加载ClassPath环境变量所指定的路径中的类，可以理解为加载写好的Java代码，这个类就是负责加载写好的类到内存里。
  4. 自定义来加载
     1. 作用：按照自己的需要加载你的类



#### 双亲委托机制

* JVM的类加载器是由亲子层结构的，就是说启动类加载器是最上层的，扩展类加载器是在第二层，第三层是应用程序类加载器，最后一层是自定义类加载器

  ![image-20211011132838281](/img/image-20211011132838281.png)

